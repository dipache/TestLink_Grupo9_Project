version: '3.7'

services:
  mariadb:
    image: mariadb:latest
    container_name: mariadb_testlink
    restart: always
    env_file:
      - params.txt
    networks:
      - testlink-network
    volumes:
      - mariadb_testlink_data:/var/lib/mysql

  testlink:
    build: .
    container_name: testlink
    restart: always
    ports:
      - ${PORT_HTTP:-80}:80
    env_file:
      - params.txt
    networks:
      - testlink-network
    volumes:
      - testlink_data:/var/www/html/testlink
    depends_on:
      - mariadb
    environment:
      - TESTLINK_LANGUAGE=${TESTLINK_LANGUAGE}
      - SMTP_ENABLE=${SMTP_ENABLE}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASSWORD=${SMTP_PASSWORD}
      - SMTP_CONNECTION_MODE=${SMTP_CONNECTION_MODE}

volumes:
  mariadb_testlink_data:
    name: mariadb_testlink_data
  testlink_data:
    name: testlink_data

networks:
  testlink-network:
    name: testlink-network
    driver: bridge
